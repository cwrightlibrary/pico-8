pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
--game loop
function _init()
 p={
  sp=1,
  flp=false,
  x=10,
  y=20,
  w=8,
  h=8,
  dx=0,
  dy=0,
  max_dx=1,
  max_dy=2,
  anim=0,
  running=false,
  sliding=false,
  landed=false,
  jumping=false,
  falling=false,
  acc=.25,
  boost=3.7
 }
 gravity=.2
 friction=.85

 cam_x=0
 map_start=0
 map_end=1024
 palt(0,false)
 palt(13,true)
end

function _update60()
 p_update()
 p_animate()
 cam_update()
end

function _draw()
 cls(12)
 palt(13,true)
 palt(0,false)
 map(0,0)
 spr(p.sp,p.x,p.y,p.w/8,p.h/8,p.flp)
end
-->8
--player
function p_update()
 p.dy+=gravity
 p.dx*=friction
 
 --input 
 --move left/right
 if btn(⬅️) then 
  p.dx-=p.acc 
  p.running=true
  p.flp=true
 end
 if btn(➡️) then 
  p.dx+=p.acc 
  p.running=true
  p.flp=false
 end
--slide
if p.running
and not btn(⬅️)
and not btn(➡️)
and not p.falling
and not p.jumping then
 p.running=false
 p.sliding=true
end
--jump
 if btnp(❎)
 and p.landed then
 sfx(1,1)
  p.dy-=p.boost 
  p.landed=false
 end

 --collisions
 --down
 if p.dy>0 then
  p.falling=true
  p.landed=false
  p.jumping=false

  p.dy=limit_speed(p.dy,p.max_dy)

  --map collisions
  if map_collision_full(p,'down',0) then
   p.landed=true
   p.falling=false
   p.dy=0
   p.y-=((p.y+p.h+1)%8)-1
  end
 --up
 elseif p.dy<0 then
  p.jumping=true
  if map_collision_full(p,'up', 1) then
   p.dy=0
  end
 end
 --left
 if p.dx<0 then
  p.dx=limit_speed(p.dx,p.max_dx)
  if map_collision_full(p,'left',1)
  or map_collision_half(p,'left',2) then
   p.dx=0
  end
 --right
 elseif p.dx>0 then 
  p.dx=limit_speed(p.dx,p.max_dx)
  if map_collision_full(p,'right',1)
  or map_collision_half(p,'right',2) then
   p.dx=0
  end
 end

 --stop sliding
 if p.sliding then
  if abs(p.dx)<.2
  or p.running then
   p.dx=0
   p.sliding=false
  end
 end
 --apply change in loc
 p.x+=p.dx
 p.y+=p.dy
 if p.x<0 then p.x=0 p.dx=0 p.running=false end
end

function p_animate()
 if p.jumping then
  sfx(-1,0)
  p.sp=18
 elseif p.falling then
  sfx(-1,0)
  p.sp=17
 elseif p.sliding then
  sfx(-1,0)
  p.sp=49
 elseif p.running then
  if not sfx(0,0) then
  sfx(0,0)
  end
  if time()-p.anim>.1 then
   p.anim=time()
   p.sp+=1
   if p.sp>34 then
    p.sp=33
   end
   if p.sp<33 then
    p.sp=33
   end
  end
 else
 sfx(-1,0)
 p.sp=1
 end
 if p.x<0 then p.x=0 p.dx=0 end
end

--speed limiter
function limit_speed(num,maximum)
 return mid(-maximum,num,maximum)
end
-->8
--collisions
function map_collision_full(obj,aim,flag)
 local x=obj.x local y=obj.y
 local w=obj.w-4 local h=obj.h
 local x1=0    local x2=0
 local y1=0    local y2=0
 --create hitbox
 if aim=='left' then
  x1=x-1 x2=x
  y1=y   y2=y+h-1
 elseif aim=='right' then
  x1=x+w x2=x+w+1
  y1=y   y2=y+h-1
 elseif aim=='up' then
  x1=x+1 x2=x+w-1
  y1=y-1 y2=y
 elseif aim=='down' then
  x1=x   x2=x+w
  y1=y+h y2=y+h
 end
 --convert hitbox to pixels
 x1/=8   x2/=8
 y1/=8   y2/=8
 --check collision
 if fget(mget(x1,y1),flag)
 or fget(mget(x1,y2),flag)
 or fget(mget(x2,y1),flag)
 or fget(mget(x2,y2),flag) then
  return true
 else
  return false
 end
end

function map_collision_half(obj,aim,flag)
 local x=obj.x local y=obj.y
 local w=obj.w local h=obj.h
 local x1=0    local x2=0
 local y1=0    local y2=0
 --create hitbox
 if aim=='left' then
  x1=x+1 x2=x+2
  y1=y   y2=y+h-1
 elseif aim=='right' then
  x1=x+w-2 x2=x+w-3
  y1=y   y2=y+h-1
 elseif aim=='up' then
  x1=x+1 x2=x+w-1
  y1=y-1 y2=y
 elseif aim=='down' then
  x1=x   x2=x+w
  y1=y+h y2=y+h
 end
 --convert hitbox to pixels
 x1/=8   x2/=8
 y1/=8   y2/=8
 --check collision
 if fget(mget(x1,y1),flag)
 or fget(mget(x1,y2),flag)
 or fget(mget(x2,y1),flag)
 or fget(mget(x2,y2),flag) then
  return true
 else
  return false
 end
end

-->8
--camera
function cam_update()
 cam_x=p.x-64+(p.w/2)
 if cam_x<map_start then
  cam_x=map_start
 end
 if cam_x>map_end then
  cam_x=map_end
 end
 camera(cam_x,0)
end
__gfx__
dddddddddd9977dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
ddddddddd999999ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dd7dd7ddd47070fddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
ddd77ddddf44444ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
ddd77ddddd44e4dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dd7dd7dddd9444dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddfd99dfddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddd4422dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddd9977dddd9977dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
ddddddddd999999dd999999ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
ddddddddd47070fdd47070fddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddf44444ddf44444ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
ddddddddf944e4dfdd4fe4dfdddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddd94449ddd94449ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
ddddddddd4d99d2dddd99ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddd4dd2dddd4d2ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddd9977dddd9977dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
ddddddddd999999dd999999ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
ddddddddd47070fdd47070fddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddf44444ddf44444ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddd44e4dddd44e4dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddf9444fddf9444fddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
ddddddddddd992dddd299d4ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddd4d2dddddd2d4dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddd9977dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
ddddddddd999999ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
ddddddddd47070fddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddf44444ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddd44e4dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddd9444dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
dddddddddfd992fddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
ddddddddddd442dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
bbbbbbbb00000000d0000000000000000000000d00000000dd00000000000000000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
33333333bbbbbbbb0bbbbbbbbbbbbbbbbbbbbbb062222666d0222666622226666222260ddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
33333333bbbbbbbb0bbbbbbbbbbbbbbbbbbbbbb022226662022266622222666222226660dddddddddddddddddddddddddddddddddddddddddddddddddddddddd
bb33333b00bbbb00d0000000000000000000000d22266622022666222226662222266620dddddddddddddddddddddddddddddddddddddddddddddddddddddddd
33333333dd0bb0dddddddddddddddddddddddddd00666200d0000000000000000000000ddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
33333bbbdd0bb0dddddddddddddddddddddddddddd0620dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
33333333dd0bb0dddddddddddddddddddddddddddd0220dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
bbb33333dd0bb0dddddddddddddddddddddddddddd0220dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
3333bbb3dd0bb0dddddddddddddddddddddddddddd0220dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
33333333dd0bb0dddddddddddddddddddddddddddd0220dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
33333333dd0bb0dddddddddddddddddddddddddddd0260dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
bb33333bdd0bb0dddddddddddddddddddddddddddd0660dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
33333333dd0bb0dddddddddddddddddddddddddddd0660dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
33333bbbdd0bb0dddddddddddddddddddddddddddd0620dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
33333333dd0bb0dddddddddddddddddddddddddddd0220dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
bbb33333dd0bb0dddddddddddddddddddddddddddd0220dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
d000000000000000000000000000000dddddddddd0000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0ffffffffffffffffffffffffffffff0dddddddd0fffffffdddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0ffffffffffffffffffffffffffffff0dddddddd0fffffffdddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
0ffffffffffffffffffffffffffffff0dddddddd0fffffffdddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00000000000000000000000000000000dddddddd00000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
09ffff9999ffff9999ffff9999fffff0dddddddd09ffff99dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
099ffff9999ffff9999ffff9999ffff0dddddddd099ffff9dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00009999900099999000999990009990dddddddd0f900999dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
09000099990000999900009999000090dddddddd0ff90099dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
09990009999900099999000999990000dddddddd0ff99009dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00999900009999000099990000999900dddddddd0ff99900dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00099990000999990009999000099990dddddddd09f99990dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
00009999900099999000999990009990dddddddd09909999dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
09900999999009999990099999900990dddddddd0ff00999dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
09990099999900999999009999990090dddddddd0ff90099dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
09999000999990009999900099999000dddddddd0ff99000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
__gff__
0000010101010103030303000000000000000001010000050000000000000000000000010100000000000000000000000000000000000000000000000000000001010101010303030300000000000000010101000005000000000000000000000101010100010000000000000000000002000003000300000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000046454745480000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000550055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000550055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000004241434144000000550055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000051005100000000550055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000051005100000000550055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000051005100000000550055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6061626162616261626162616261626163646561626162616261626162616261626162616261626162616261626162616261626162616261626162616261626162616261626162616261626162616261626162616261626162616261626162616261626162616261626162616261626162616261626162616261626162616261
7071727172717271727172717271727173647571727172717271727172717271727172717271727172717271727172717271727172717271727172717271727172717271727172717271727172717271727172717271727172717271727172717271727172717271727172717271727172717271727172717271727172717271
7071717171717171717171717171717173647571717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171
7071717171717171717171717171717173647571717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171
__sfx__
c101001f3b0252e705327002e705327002e705327002e705370052e7053270000705327000070532700007053b025007050070500705007050070500705007053270500705007050070500705007050070500705
91040000150100e0212a031300312c000270002e00018000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
