pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
function _init()
 p={}
 p.sp=1
 p.flp=false
 p.x=0
 p.y=14
 p.w=2
 p.h=2
 p.dx=0
 p.dy=0
 p.max_dx=.55
 p.max_dy=3
 p.acc=.5
 p.boost=3
 p.jumping=false
 p.falling=false
 p.running=false
 p.landed=true
 p.sliding=false

 gravity=.2
 friction=.85

 palt(0,false)
 palt(2, true)
end

function _update60()
 p_update()
end

function _draw()
 cls()
 map(0,0,0,0)
 spr(p.sp,p.x*8,p.y*8,p.w,p.h,p.flp)
end

function p_update()
 p.dy+=gravity
 p.dx*=friction

 --input
 if btn(0) then
  p.dx-=p.acc
  p.running=true
  p.flp=true
 end
 if btn(1) then
  p.dx+=p.acc
  p.running=true
  p.flp=false
 end
 if p.running
 and not btn(0)
 and not btn(1)
 and not p.falling
 and not p.jumping then
  p.running=false
  p.sliding=true
 end
 if btn(4)
 and p.landed then
  p.dy-=p.boost
  p.landed=false
 end

 --collisions
 if p.dy>0 then
  p.falling=true
  p.landed=false
  p.jumping=false

  p.dy=limit_speed(p.dy,p.max_dy)

  --map collisions
  if map_collision_full(p,'down',0) then
   p.landed=true
   p.falling=false
   p.dy=0
   p.y-=((p.y+p.h+1)%8)-1
  end
 elseif p.dy<0 then
  p.jumping=true
  if map_collision(p,'up',1) then
   p.dy=0
  end
 end
 if p.dx<0 then
  p.dx=limit_speed(p.dx,p.max_dx)
  if map_collision(p,'left',2)
  and not p.falling
  and not p.jumping then
   p.dx=0
  end
 elseif p.dx>0 then
  p.dx=limit_speed(p.dx,p.max_dx)
  if map_collision(p,'right',1) then
   p.dx=0
  end
 end
 if p.sliding then
  if abs(p.dx)<0.2
  or p.running then
   p.dx=0
   p.sliding=false
  end
 end
 p.x+=p.dx
 p.y+=p.dy
 if p.x<0 then
  p.x=0
  p.dx=0
  p.running=false
 end
 if p.y>128 then _init() end
end

function limit_speed(num,maximum)
 return mid(-maximum,num,maximum)
end

function map_collision(obj,aim,flag)
 local x=obj.x local y=obj.y
 local w=obj.w local h=obj.h
 local x1=0    local x2=0
 local y1=0    local y2=0
 --create hitbox
 if aim=='left' then
  x1=x         x2=x+2
  y1=y-1       y2=y+h-2
 elseif aim=='right' then
  x1=x+w       x2=x+w
  y1=y-1       y2=y+h
 elseif aim=='up' then
  x1=x         x2=x+w
  y1=y         y2=y
 elseif aim=='down' then
  x1=x         x2=x+w
  y1=y+h       y2=y+h
 end

 --convert hitbox to pixels
 x1/=8        x2/=8
 y1/=8        y2/=8

 --check collision
 if fget(mget(x1,y1),flag)
 or fget(mget(x1,y2),flag)
 or fget(mget(x2,y1),flag)
 or fget(mget(x2,y2),flag) then
  return true
 else
  return false
 end
end
__gfx__
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000220000002222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00700700200000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00077000200444440222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00077000204004400222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00700700200770077022222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000000770007022222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000204004400022222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000220444440222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
0000000020d000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
000000000d0ed0e0d022222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000000dedd00022222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000040000004022222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000200000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000220900902222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222002002222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222221166616666666666666666666666666661666122222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222221116661111111111111111111111111116661122222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222211111111111111111111111111111111111111122222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222211116611111111111111111111111111111661122222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222111116611111111111111111111111111111661122222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222111116611111111111111111111111111111661122222222222222222222222222222222222222222222222222222222222222222222222222222222
22222221111116611111111111111111111111111111661122222222222222222222222222222222222222222222222222222222222222222222222222222222
22222221111111111111111111111111111111111111111122222222222222222222222222222222222222222222222222222222222222222222222222222222
22222211111166616666666666666666666666666661666122222222222222222222222222222222222222222222222222222222222222222222222222222222
22222211111116661111111111111111111111111116661122222222222222222222222222222222222222222222222222222222222222222222222222222222
22222111111111111111111111111111111111111111111122222222222222222222222222222222222222222222222222222222222222222222222222222222
22222111111116611111111111111111111111111111661122222222222222222222222222222222222222222222222222222222222222222222222222222222
22221111111116611111111111111111111111111111661122222222222222222222222222222222222222222222222222222222222222222222222222222222
22221111111116611111111111111111111111111111661122222222222222222222222222222222222222222222222222222222222222222222222222222222
22221111111116611111111111111111111111111111661122222222222222222222222222222222222222222222222222222222222222222222222222222222
22221111111111111111111111111111111111111111111122222222222222222222222222222222222222222222222222222222222222222222222222222222
22221111111111116666666666666666666666666661111111111111222222222222222222222222222222222222222222222222222222222222222222222222
22221111111116616666666666666666666666666661661111111111222222222222222222222222222222222222222222222222222222222222222222222222
22221111111116611111111111111111111111111111661111111111222222222222222222222222222222222222222222222222222222222222222222222222
22221111111116611666666666166666661666666611661100000000222222222222222222222222222222222222222222222222222222222222222222222222
22221111111111111666666116161166661611666611111110111011222222222222222222222222222222222222222222222222222222222222222222222222
22221111111116611666666666166666661666666611661100000000222222222222222222222222222222222222222222222222222222222222222222222222
22221111111166661666666666166666661666666616666101010101222222222222222222222222222222222222222222222222222222222222222222222222
22221111111111111111111111111111111111111111111100000000222222222222222222222222222222222222222222222222222222222222222222222222
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041424344450000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5051525354550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6051525354550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6051525354550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6051525354550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6051525354550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6061626364650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6666666666666666666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
